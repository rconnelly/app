<section data-ng-controller="SubscriptionsController" data-ng-init="init()">

    <h2>{{ pageTitle }}</h2>
    <form name="subscriptionForm" class="form" role="form" data-ng-submit="save(subscription)" novalidate>

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4>Details</h4>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="form-group col-md-4" data-ng-class="{ 'has-error' : submitted && subscriptionForm.itemName.$invalid }">
                                <label mean-token="'create-subscription-customer'" for="customerName" class="control-label">Customer</label>
                                <input type="text" name="customerName" class="form-control" data-ng-model="subscription.customer"
                                       typeahead="customer as customer.displayName for customer in findCustomers($viewValue) | filter:$viewValue | limitTo:8"
                                       id="customerName" placeholder="required" required />
                                <div ng-show="submitted && subscriptionForm.customerName.$invalid" class="help-block">
                                    <p ng-show="subscriptionForm.customerName.$error.required">A customer is required.</p>
                                </div>
                            </div>
                            <div class="form-group col-md-4" data-ng-class="{ 'has-error' : submitted && subscriptionForm.startDate.$invalid }">
                                <label mean-token="'create-item-start-date'" for="startDate" class="control-label">Start Date</label>
                                <div class="input-group">
                                    <input type="text" name="startDate" id="startDate" class="form-control" datepicker-popup="{{format}}" ng-model="subscription.startDate" is-open="startDateOpened"
                                           min-date="minDate" max-date="maxDate" datepicker-options="dateOptions"
                                           ng-required="true" close-text="Close" />
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-default" ng-click="openStartDate($event)">
                                            <i class="glyphicon glyphicon-calendar"></i>
                                        </button>
                                    </span>
                                </div>
                                <div ng-show="submitted && subscriptionForm.startDate.$invalid" class="help-block">
                                    <p ng-show="subscriptionForm.startDate.$error.required">Item price is required</p>
                                </div>
                            </div>
                            <div class="form-group col-md-4" data-ng-class="{ 'has-error' : submitted && subscriptionForm.memo.$invalid }">
                                <label mean-token="'create-item-memo'" for="memo" class="control-label">Memo</label>
                                <textarea name="memo" id="memo" data-ng-model="subscription.memo" class="form-control"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive" data-ng-show="items.length !== 0">
                                    <table class="table table-striped table-bordered" ng-table="tableParams">
                                        <tbody ng-repeat="item in $data">
                                        <tr>
                                            <td class="col-sm-2 text-center" data-title="'Name'" data-sortable="'name'" data-filter="{ 'name': 'text' }">
                                                <strong>{{item.name}}</strong><br />
                                                {{ item.description }}
                                            </td>
                                            <td class="col-sm-2 text-center" data-title="'Qty'" sortable="'qty'" data-filter="{ 'qty': 'text' }">
                                                <span ng-if="!item.$edit">{{item.qty}}</span>
                                                <div ng-if="item.$edit"><input type="text" name="editItemPrice" id="editItemPrice" class="form-control text-center" ng-model="item.qty" value="{{item.qty}}"></div>
                                            </td>
                                            <td class="col-sm-2 text-center" data-title="'Price'" sortable="'price'" data-filter="{ 'price': 'text' }">
                                                {{item.price | currency}}
                                            </td>
                                            <td class="col-sm-2 text-center" data-title="'Extended'" sortable="'extended'" data-filter="{ 'extended': 'text' }">
                                                {{item.extended | currency}}
                                            </td>
                                            <td class="col-sm-4 text-right">
                                                <a class="btn btn-secondary" data-ng-click="editItem(item);" ng-if="!item.$edit">
                                                    Edit
                                                </a>
                                                <a class="btn btn-danger" data-ng-click="removeItem(item);" ng-if="!item.$edit">
                                                    Remove
                                                </a>
                                                <a class="btn btn-primary" data-ng-click="doneEdit(item);" ng-if="item.$edit">
                                                    Ok
                                                </a>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-offset-1 col-md-3" data-ng-class="{ 'has-error' : submitted && subscriptionForm.itemName.$invalid }">
                                <select name="newItem" class="form-control" id="newItem" data-ng-model="newItem"
                                        ng-options="item as item.name for item in items" required>
                                    <option value="" selected disabled>Items</option>
                                </select>

                                <div ng-show="submitted && subscriptionForm.itemName.$invalid" class="help-block">
                                    <p ng-show="subscriptionForm.itemName.$error.required">An item is required</p>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <button type="button" class="btn btn-secondary" ng-disabled="!newItem" ng-click="addItem(newItem)">Add Item</button>
                            </div>

                            <div class="form-group col-md-offset-1 col-md-3" data-ng-class="{ 'has-error' : submitted && subscriptionForm.itemName.$invalid }">
                                <select name="newDiscount" class="form-control" id="newDiscount" data-ng-model="newItem"
                                        ng-options="" required>
                                    <option value="" selected disabled>Discounts</option>
                                </select>

                                <div ng-show="submitted && subscriptionForm.itemName.$invalid" class="help-block">
                                    <p ng-show="subscriptionForm.itemName.$error.required">An item is required</p>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <button type="button" class="btn btn-default" ng-disabled="!newDiscount" ng-click="addDiscount(newDiscount)">Add Discount</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="row">
        <div class="col-md-12">
            <div class=" panel panel-default btn-toolbar">
                <div class="panel-body text-center">
                    <button type="button" class="btn btn-default btn-lg" data-ng-click="cancel()">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-lg">Save</button>
                </div>
            </div>
        </div>
    </div>
    </form>
</section>
